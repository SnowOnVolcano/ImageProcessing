## ä¸€ç‚¹è¯´æ˜

#### 1. å®Œæˆæƒ…å†µ

- è¯¦ç»†é˜è¿°äº†äººè„¸è¯†åˆ«ä¸­çš„ç»å…¸ç®—æ³•ä¸æ·±åº¦å­¦ä¹ ç®—æ³•
- **æ‰‹ åŠ¨ å® ç°** äº†ä¸‰ç§äººè„¸è¯†åˆ«ç»å…¸ç®—æ³•
  - åŸºäºä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰çš„Eigenfacesç‰¹å¾è„¸æ–¹æ³•
  - åŸºäºçº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰çš„Fisherfacesç‰¹å¾è„¸æ–¹æ³•
  - å±€éƒ¨äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆLBPï¼‰ç›´æ–¹å›¾æ–¹æ³•
- å®éªŒå¯¹æ¯”åˆ†æäº†ä¸‰ç§äººè„¸è¯†åˆ«ç»å…¸ç®—æ³• å’Œ CNN å®ç°äººè„¸è¯†åˆ«çš„ç‰¹ç‚¹ä»¥åŠå¼‚åŒç‚¹


#### 2. é¡¹ç›®ç»“æ„

- **data/**ï¼ˆå­˜æ”¾é¡¹ç›®ç”¨åˆ°çš„æ•°æ®é›†ï¼Œå¦‚æœ‰æ›´æ”¹ï¼Œè®°å¾—ä¿®æ”¹ä»£ç ä¸­çš„å¼•ç”¨åœ°å€ï¼‰
- **src/**ï¼ˆå­˜æ”¾æºä»£ç ï¼Œç›´æ¥è¿è¡Œ src/ ä¸­çš„ Classical_Methods.py å³å¯ï¼‰
- **README.md** ï¼ˆå®éªŒæŠ¥å‘Šï¼‰

## æ€è·¯åˆ†æ

### 0. äººè„¸è¯†åˆ« ç»¼è¿°

> å‚è€ƒé“¾æ¥ï¼š[ã€ŠFace Recognition: From Traditional to Deep Learning Methodsã€‹](https://arxiv.org/abs/1811.00116)ï¼Œ[ã€Šäººè„¸è¯†åˆ«åˆé›† | äººè„¸è¯†åˆ«æ¦‚è¿°ã€‹](https://zhuanlan.zhihu.com/p/76513217)

â€‹	**äººè„¸è¯†åˆ«ï¼ˆFace Recognitionï¼‰**æ˜¯æŒ‡ **èƒ½å¤Ÿè¯†åˆ«æˆ–éªŒè¯å›¾åƒæˆ–è§†é¢‘ä¸­çš„ä¸»ä½“çš„èº«ä»½ **çš„æŠ€æœ¯ã€‚è‡ªä¸Šä¸ªä¸–çºªä¸ƒåå¹´ä»£é¦–ä¸ªäººè„¸è¯†åˆ«ç®—æ³•è¢«æå‡ºä»¥æ¥ï¼Œäººè„¸è¯†åˆ«å·²ç»æˆä¸ºäº†è®¡ç®—æœºè§†è§‰ä¸ç”Ÿç‰©è¯†åˆ«é¢†åŸŸè¢«ç ”ç©¶æœ€å¤šçš„ä¸»é¢˜ä¹‹ä¸€ã€‚ç©¶å…¶ç«çˆ†çš„åŸå› ï¼Œä¸€æ–¹é¢æ˜¯å®ƒçš„**æŒ‘æˆ˜æ€§**â€”â€”åœ¨æ— çº¦æŸæ¡ä»¶çš„ç¯å¢ƒä¸­çš„äººè„¸ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“è‡ªç„¶äººè„¸ï¼ˆFaces in-the-wildï¼‰ï¼Œå…·æœ‰é«˜åº¦çš„å¯å˜æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼›å¦ä¸€æ–¹é¢æ˜¯ç”±äºç›¸æ¯”äºæŒ‡çº¹æˆ–è™¹è†œè¯†åˆ«ç­‰ä¼ ç»Ÿä¸Šè¢«è®¤ä¸ºæ›´åŠ ç¨³å¥çš„ç”Ÿç‰©è¯†åˆ«æ–¹æ³•ï¼Œäººè„¸è¯†åˆ«æœ¬è´¨ä¸Šæ˜¯**éä¾µå…¥æ€§**çš„ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯æœ€è‡ªç„¶ã€æœ€ç¬¦åˆäººç±»ç›´è§‰çš„ä¸€ç§ç”Ÿç‰©è¯†åˆ«æ–¹æ³•ã€‚

![image-20200528151906435](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200528151906435.png)

â€‹	ç°ä»£äººè„¸è¯†åˆ«æŠ€æœ¯çš„ç ”ç©¶çƒ­æ½®ï¼Œå·²ç»ä»ä½¿ç”¨äººå·¥è®¾è®¡çš„ç‰¹å¾ï¼ˆå¦‚è¾¹å’Œçº¹ç†æè¿°é‡ç­‰ï¼‰ä¸æœºå™¨å­¦ä¹ æŠ€æœ¯ï¼ˆå¦‚ä¸»æˆåˆ†åˆ†æã€çº¿æ€§åˆ¤åˆ«åˆ†æå’Œæ”¯æŒå‘é‡æœºç­‰ï¼‰ç»„åˆçš„ä¼ ç»Ÿæ–¹æ³•çš„ç ”ç©¶ï¼Œé€æ¸è½¬ç§»åˆ°ä½¿ç”¨åºå¤§äººè„¸æ•°æ®é›†æ­å»ºä¸åœ¨å…¶åŸºç¡€ä¸Šè®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œçš„ç ”ç©¶ã€‚ä½†æ˜¯ï¼Œæ— è®ºæ˜¯åŸºäºä¼ ç»Ÿæ–¹æ³•è¿˜æ˜¯æ·±åº¦ç¥ç»ç½‘ç»œï¼Œ**äººè„¸è¯†åˆ«çš„æµç¨‹**éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œå¤§æ¦‚**ç”±ä»¥ä¸‹å››ä¸ªæ¨¡å—ç»„æˆï¼š**

- **äººè„¸æ£€æµ‹** ï¼šæå–å›¾åƒä¸­çš„äººè„¸ï¼Œåˆ’å®šè¾¹ç•Œï¼›
- **äººè„¸å¯¹é½** ï¼šä½¿ç”¨ä¸€ç»„ä½äºå›¾åƒä¸­å›ºå®šä½ç½®çš„å‚è€ƒç‚¹æ¥ç¼©æ”¾å’Œè£å‰ªäººè„¸å›¾åƒï¼›
- **äººè„¸è¡¨å¾** ï¼šäººè„¸å›¾åƒçš„åƒç´ å€¼ä¼šè¢«è½¬æ¢æˆç´§å‡‘ä¸”å¯åˆ¤åˆ«çš„ç‰¹å¾å‘é‡ï¼Œæˆ–ç§°æ¨¡æ¿ï¼›
- **äººè„¸åŒ¹é…** ï¼šé€‰å–å¹¶è®¡ç®—ä¸¤ä¸ªæ¨¡æ¿é—´çš„ç›¸ä¼¼åº¦åˆ†æ•°æ¥åº¦é‡ä¸¤è€…å±äºåŒä¸€ä¸ªä¸»ä½“çš„å¯èƒ½æ€§ã€‚

![preview](https://pic1.zhimg.com/v2-c281b1e0b0395c79bbe0eb6a1e9acd0c_r.jpg)

### 1. ä¼ ç»Ÿç®—æ³•â€”â€”ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ä¸ çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰

> å‡†ç¡®åœ°è¯´ï¼Œæ˜¯ **åŸºäºä¸»æˆåˆ†åˆ†æçš„Eigenfacesç‰¹å¾è„¸æ–¹æ³•** ä¸ **åŸºäºçº¿æ€§åˆ¤åˆ«åˆ†æçš„Fisherfacesç‰¹å¾è„¸æ–¹æ³•**ï¼Œè¿™æ˜¯æ ¹æ®**æ•´ä½“ç‰¹å¾**è¿›è¡Œäººè„¸è¾¨åˆ«çš„ä¸¤ç§æ–¹æ³•ã€‚

#### 1ï¼‰ç®—æ³•æ¡†æ¶

â€‹	ä½¿ç”¨ **PCA** æˆ– **LDA** è¿›è¡Œäººè„¸è¯†åˆ«çš„ç®—æ³•æµç¨‹ååˆ†ç›¸ä¼¼ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚

1. **è¯»å–äººè„¸å›¾ç‰‡æ•°æ®åº“çš„å›¾åƒåŠæ ‡ç­¾ï¼Œå¹¶è¿›è¡Œç°åº¦åŒ–å¤„ç†**ï¼ˆå¯ä»¥åŒæ—¶è¿›è¡Œç›´æ–¹å›¾å‡è¡¡ç­‰ï¼‰
2. **å°†è¯»å…¥çš„äºŒç»´å›¾åƒæ•°æ®ä¿¡æ¯è½¬ä¸ºä¸€ç»´å‘é‡ï¼Œç„¶åæŒ‰åˆ—ç»„åˆæˆåŸå§‹æ•°æ®çŸ©é˜µ**
4. **å¯¹åŸå§‹çŸ©é˜µè¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå¹¶ä½¿ç”¨PCAæˆ–LDAç®—æ³•å¯¹åŸå§‹æ•°æ®çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†æä¸é™ç»´**ï¼ˆè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®åŸå§‹æ•°æ®å¾—åˆ°ä¸€ç»´å‡å€¼å‘é‡ç»è¿‡ç»´åº¦çš„è¿˜åŸä»¥åå¾—åˆ°çš„å›¾åƒä¸ºâ€œå¹³å‡è„¸â€ï¼‰
4. **è¯»å–å¾…è¯†åˆ«çš„å›¾åƒï¼Œå°†å…¶è½¬åŒ–ä¸ºä¸è®­ç»ƒé›†ä¸­çš„åŒæ ·çš„å‘é‡è¡¨ç¤ºï¼Œéå†è®­ç»ƒé›†ï¼Œå¯»æ‰¾ä¸å¾…è¯†åˆ«å›¾åƒçš„å·®å€¼å°äºé˜ˆå€¼ï¼ˆæˆ–å·®å€¼æœ€å°ï¼‰çš„å›¾åƒï¼Œå³ä¸ºè¯†åˆ«ç»“æœ**

#### 2ï¼‰PCA åŸç†

> å‚è€ƒé“¾æ¥ï¼š[ã€ŠPCAçš„æ•°å­¦åŸç†ã€‹](http://blog.codinglabs.org/articles/pca-tutorial.html) ï¼ˆå¼ºçƒˆæ¨èï¼Œè®²å¾—éå¸¸é€å½»ï¼ï¼‰

â€‹	**PCAï¼ˆPrincipal Component Analysisï¼Œä¸»æˆåˆ†åˆ†æï¼‰**æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®åˆ†ææ–¹æ³•ã€‚PCAé€šè¿‡çº¿æ€§å˜æ¢å°†åŸå§‹æ•°æ®å˜æ¢ä¸ºä¸€ç»„å„ç»´åº¦çº¿æ€§æ— å…³çš„è¡¨ç¤ºï¼Œå¯ç”¨äºæå–æ•°æ®çš„ä¸»è¦ç‰¹å¾åˆ†é‡ï¼Œå¸¸ç”¨äºé«˜ç»´æ•°æ®çš„é™ç»´ã€‚

##### I.  ä¸ºä»€ä¹ˆè¦é™ç»´ï¼Ÿ

â€‹	æ•°æ®åˆ†ææ—¶ï¼ŒåŸå§‹æ•°æ®çš„ç»´åº¦ä¸ç®—æ³•çš„å¤æ‚åº¦æœ‰ç€å¯†åˆ‡çš„å…³ç³»ï¼Œåœ¨ä¿ç•™åŸå§‹æ•°æ®ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œå¯¹æ•°æ®è¿›è¡Œé™ç»´å¯ä»¥æœ‰æ•ˆåœ°æé«˜æ—¶é—´æ•ˆç‡ï¼Œå‡å°‘ç®—åŠ›æŸå¤±ã€‚

##### II. PCAé™ç»´çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

â€‹	é™ç»´æ„å‘³ç€ä¿¡æ¯çš„ä¸¢å¤±ï¼Œä½†æ˜¯ç”±äºå®é™…æ•°æ®å†…éƒ¨å¾€å¾€å…·æœ‰ç›¸å…³æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§ç›¸å…³æ€§ï¼Œé€šè¿‡æŸäº›æ–¹æ³•ä½¿å¾—åœ¨æ•°æ®ç»´åº¦å‡å°‘çš„åŒæ—¶ä¿ç•™å°½å¯èƒ½å¤šçš„åŸå§‹ç‰¹å¾ï¼Œè¿™å°±æ˜¯PCAç®—æ³•çš„åˆè¡·ã€‚

â€‹	é‚£ä¹ˆè¿™ä¸€æƒ³æ³•å¦‚ä½•è½¬åŒ–ä¸ºç®—æ³•å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Nç»´ç©ºé—´å¯¹åº”äº†ç”±Nä¸ªçº¿æ€§æ— å…³çš„åŸºå‘é‡æ„æˆçš„ä¸€ç»„åŸºï¼Œç©ºé—´ä¸­çš„ä»»ä¸€å‘é‡éƒ½å¯ç”¨è¿™ç»„åŸºæ¥è¡¨ç¤ºã€‚æˆ‘ä»¬è¦å°†ä¸€ç»„Nç»´å‘é‡é™ä¸ºKç»´ï¼ˆKå¤§äº0ï¼Œå°äºNï¼‰ï¼Œå…¶å®åªéœ€è¦é€šè¿‡çŸ©é˜µä¹˜æ³•å°†åŸNç»´ç©ºé—´ä¸­çš„å‘é‡è½¬åŒ–ä¸ºç”±Kä¸ªçº¿æ€§æ— å…³çš„åŸºå‘é‡æ„æˆçš„ä¸€ç»„åŸºä¸‹çš„è¡¨ç¤ºã€‚

â€‹	ä½†æ˜¯ï¼Œè¿™ä¸€ç»„Kç»´çš„åŸºå¹¶ä¸æ˜¯éšä¾¿æŒ‡å®šçš„ã€‚ä¸ºäº†å°½å¯èƒ½ä¿ç•™åŸå§‹ç‰¹å¾ï¼Œæˆ‘ä»¬å¸Œæœ›å°†åŸå§‹æ•°æ®å‘é‡æŠ•å½±åˆ°ä½ç»´ç©ºé—´æ—¶ï¼ŒæŠ•å½±åå„å­—æ®µï¼ˆè¡Œå‘é‡ï¼‰ä¸é‡åˆï¼ˆæ˜¾ç„¶é‡åˆä¼šè¦†ç›–ç‰¹å¾ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½¿å˜æ¢åæ•°æ®ç‚¹å°½å¯èƒ½åˆ†æ•£ï¼Œè¿™å°±è‡ªç„¶åœ°è”ç³»åˆ°äº†çº¿æ€§ä»£æ•°ä¸­çš„æ–¹å·®ä¸åæ–¹å·®ã€‚

![image-20200528152425799](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200528152425799.png)

â€‹	æ‰€ä»¥ï¼Œç»¼åˆæ¥çœ‹ï¼Œæˆ‘ä»¬é™ç»´çš„ç›®æ ‡ä¸º é€‰æ‹©Kä¸ªåŸºå‘é‡ï¼ˆä¸€èˆ¬è½¬åŒ–ä¸ºå•ä½é•¿åº¦çš„æ­£äº¤åŸºï¼‰ï¼Œä½¿å¾—åŸå§‹æ•°æ®å˜æ¢åˆ°è¿™ç»„åŸºä¸Šåï¼Œå„å­—æ®µä¸¤ä¸¤é—´åæ–¹å·®ä¸º0ï¼Œè€Œå­—æ®µçš„æ–¹å·®åˆ™å°½å¯èƒ½å¤§ï¼ˆåœ¨æ­£äº¤çš„çº¦æŸä¸‹ï¼Œå–æœ€å¤§çš„Kä¸ªæ–¹å·®ï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯PCAçš„åŸç†â€”â€”PCAæœ¬è´¨ä¸Šæ˜¯å°†æ–¹å·®æœ€å¤§çš„æ–¹å‘ä½œä¸ºä¸»è¦ç‰¹å¾ï¼Œå¹¶ä¸”åœ¨å„ä¸ªæ­£äº¤æ–¹å‘ä¸Šå°†æ•°æ®â€œç¦»ç›¸å…³â€ï¼Œä¹Ÿå°±æ˜¯è®©å®ƒä»¬åœ¨ä¸åŒæ­£äº¤æ–¹å‘ä¸Šæ²¡æœ‰ç›¸å…³æ€§ã€‚

##### III. å¦‚ä½•ä½¿ç”¨PCAè¿›è¡Œé™ç»´ï¼Ÿ

â€‹	åœ¨ä¸Šä¸€ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»ä»‹ç»äº†PCAçš„ç®—æ³•æµç¨‹ã€‚è½¬åŒ–æˆå…·ä½“çš„æ•°å­¦æ–¹æ³•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ï¼ˆè®¾æœ‰ $m$ æ¡ $n$ ç»´æ•°æ®ï¼Œå°†å…¶é™ä¸º $k$ ç»´ï¼‰ï¼š

- å°†åŸå§‹æ•°æ®æŒ‰åˆ—ç»„æˆ $n$ è¡Œ $m$ åˆ—çŸ©é˜µ $X$
- çŸ©é˜µ $X$ ä¸­æ¯ä¸€ç»´çš„æ•°æ®éƒ½å‡å»è¯¥ç»´çš„å‡å€¼ï¼Œä½¿å¾—å˜æ¢åçŸ©é˜µ $Xâ€™$ æ¯ä¸€ç»´å‡å€¼ä¸º $0$
- æ±‚å‡ºåæ–¹å·®çŸ©é˜µ $C=\frac{1}{m}X'X'^T$ï¼Œè¿›ä¸€æ­¥æ±‚å‡ºçŸ©é˜µ $C$ çš„ç‰¹å¾å€¼åŠå¯¹åº”çš„ç‰¹å¾å‘é‡
- å°†ç‰¹å¾å‘é‡æŒ‰å¯¹åº”ç‰¹å¾å€¼å¤§å°ä»ä¸Šåˆ°ä¸‹æŒ‰è¡Œæ’åˆ—æˆçŸ©é˜µï¼Œå–å‰ $k$ è¡Œç»„æˆçŸ©é˜µ $P$
- $Y=PX$ å³ä¸ºé™ç»´åˆ° $k$ ç»´åçš„æ•°æ®

##### IV. PCAçš„ç¼ºç‚¹ä¸ä¸è¶³

â€‹	PCAæ˜¯ä¸€ç§æ— å‚æ•°æŠ€æœ¯ï¼Œæ— æ³•è¿›è¡Œä¸ªæ€§åŒ–çš„ä¼˜åŒ–ï¼›PCAå¯ä»¥è§£é™¤çº¿æ€§ç›¸å…³ï¼Œä½†æ— æ³•å¤„ç†é«˜é˜¶çš„ç›¸å…³æ€§ï¼›PCAå‡è®¾æ•°æ®å„ä¸»ç‰¹å¾åˆ†å¸ƒåœ¨æ­£äº¤æ–¹å‘ï¼Œæ— æ³•è¾ƒå¥½åº”å¯¹ä¸»ç‰¹å¾åœ¨éæ­£äº¤æ–¹å‘çš„æƒ…å†µã€‚

##### V.  PCA çš„ python å®ç°

> ç”¨ Python è¯­è¨€å®ç°ä¸Šè¿°ç®—æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼Œä»…å±•ç¤ºä»£ç æ ¸å¿ƒéƒ¨åˆ†ï¼Œè¯¦ç»†ä»£ç **è¯·è§é™„ä»¶**ã€‚
>
> å‚è€ƒé“¾æ¥ï¼š[ã€Šäººè„¸è¯†åˆ«ç»å…¸ç®—æ³•å®ç°ï¼ˆä¸€ï¼‰â€”â€”ç‰¹å¾è„¸æ³•ã€‹](https://blog.csdn.net/freedom098/article/details/52088064)ï¼Œ[ã€Šopencvå­¦ä¹ ä¹‹è·¯ï¼ˆ40ï¼‰ã€äººè„¸è¯†åˆ«ç®—æ³•â€”â€”EigenFaceã€FisherFaceã€LBPHã€‹](https://www.cnblogs.com/little-monkey/p/8118938.html)ï¼Œ[ã€Šç»å…¸äººè„¸è¯†åˆ«ç®—æ³•å°ç»“â€”â€”EigenFace, FisherFace & LBPHï¼ˆä¸‹ï¼‰ã€‹](https://blog.csdn.net/kuweicai/article/details/79330524?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase)

```python
def algorithm_pca(data_mat):
    """
    PCAå‡½æ•°ï¼Œç”¨äºæ•°æ®é™ç»´
    :param data_mat: æ ·æœ¬çŸ©é˜µ
    :return: é™ç»´åçš„æ ·æœ¬çŸ©é˜µå’Œå˜æ¢çŸ©é˜µ
    """
    mean_mat = np.mat(np.mean(data_mat, 1)).T
    cv2.imwrite('./data/face_test/mean_face.jpg', np.reshape(mean_mat, IMG_SIZE))

    diff_mat = data_mat - mean_mat
    # print('å·®å€¼çŸ©é˜µ', diff_mat.shape, diff_mat)
    cov_mat = (diff_mat.T * diff_mat) / float(diff_mat.shape[1])
    # print('åæ–¹å·®çŸ©é˜µ', cov_mat.shape, cov_mat)

    eig_vals, eig_vecs = np.linalg.eig(np.mat(cov_mat))
    # print('ç‰¹å¾å€¼ï¼ˆæ‰€æœ‰ï¼‰ï¼š', eig_vals, 'ç‰¹å¾å‘é‡ï¼ˆæ‰€æœ‰ï¼‰ï¼š', eig_vecs.shape, eig_vecs)

    eig_vecs = diff_mat * eig_vecs
    eig_vecs = eig_vecs / np.linalg.norm(eig_vecs, axis=0)
    eig_val = (np.argsort(eig_vals)[::-1])[:DIM]
    eig_vec = eig_vecs[:, eig_val]
    # print('ç‰¹å¾å€¼ï¼ˆé€‰å–ï¼‰ï¼š', eig_val, 'ç‰¹å¾å‘é‡ï¼ˆé€‰å–ï¼‰ï¼š', eig_vec.shape, eig_vec)

    low_mat = eig_vec.T * diff_mat
    # print('ä½ç»´çŸ©é˜µï¼š', low_mat)

    return low_mat, eig_vec
```

#### 3ï¼‰LDA åŸç†

> å‚è€ƒé“¾æ¥ï¼š[ã€ŠLinear  Discriminant Analysisã€‹](http://www.cnblogs.com/jerrylead/archive/2011/04/21/2024384.html)ï¼Œ[ã€Šäººè„¸è¯†åˆ«ç»å…¸ç®—æ³•ä¸‰ï¼šFisherfaceï¼ˆLDAï¼‰ã€‹](https://blog.csdn.net/smartempire/article/details/23377385)ï¼Œ[ã€Šäººè„¸è¯†åˆ«ç³»åˆ—äºŒ | FisherFaceï¼ŒLBPHç®—æ³•åŠDlibäººè„¸æ£€æµ‹ã€‹](https://zhuanlan.zhihu.com/p/92132280)

â€‹	**LDAï¼ˆLinear Discriminant Analysisï¼Œçº¿æ€§åˆ¤åˆ«åˆ†æï¼‰**ç®—æ³•çš„æ€è·¯ä¸PCAç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹å›¾åƒçš„æ•´ä½“åˆ†æã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒPCAæ˜¯é€šè¿‡ç¡®å®šä¸€ç»„æ­£äº¤åŸºå¯¹æ•°æ®è¿›è¡Œé™ç»´ï¼Œè€ŒLDAæ˜¯é€šè¿‡ç¡®å®šä¸€ç»„æŠ•å½±å‘é‡ä½¿å¾—æ•°æ®é›†ä¸åŒç±»çš„æ•°æ®æŠ•å½±çš„å·®åˆ«è¾ƒå¤§ã€åŒä¸€ç±»çš„æ•°æ®ç»è¿‡æŠ•å½±æ›´åŠ èšåˆã€‚åœ¨å½¢å¼ä¸Šï¼ŒPCAä¸LDAçš„æœ€å¤§åŒºåˆ«åœ¨äºï¼ŒPCAä¸­æœ€ç»ˆæ±‚å¾—çš„ç‰¹å¾å‘é‡æ˜¯æ­£äº¤çš„ï¼Œè€ŒLDAä¸­çš„ç‰¹å¾å‘é‡ä¸ä¸€å®šæ­£äº¤ã€‚

##### I.  LDAçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

â€‹	åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†LDAçš„ç›®æ ‡ï¼šä¸åŒçš„åˆ†ç±»å¾—åˆ°çš„æŠ•å½±ç‚¹è¦å°½é‡åˆ†å¼€ï¼›åŒä¸€ä¸ªåˆ†ç±»æŠ•å½±åå¾—åˆ°çš„ç‚¹è¦å°½é‡èšåˆã€‚

![image-20200528165432681](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200528165432681.png)

â€‹	ä¸ºäº†å®šé‡åˆ†æè¿™ä¸¤ç‚¹ï¼Œä»¥è®¡ç®—åˆé€‚çš„æŠ•å½±çŸ©é˜µï¼Œæˆ‘ä»¬å®šä¹‰äº†ç±»å†…æ•£åˆ—åº¦çŸ©é˜µ $S_{w}$å’Œ ç±»é—´æ•£åˆ—åº¦çŸ©é˜µ $S_B $ ã€‚ å…¶ä¸­ $S_w=\sum ^c_{i=1}{\sum _{x\in Ï‰_i}(x-Î¼_i)(x-Î¼_i)^T}$, $c$ ä¸ºç±»åˆ«æ€»æ•°ï¼Œ$Î¼_i$ä»£è¡¨ç±»åˆ« $i$ çš„å‡å€¼çŸ©é˜µï¼›$S_B=\sum ^c_{i=1}N_i(Î¼_i-Î¼)(Î¼_i-Î¼)^T$ï¼Œ$N_i$ ä¸ºç±»åˆ«$i$ çš„æ•°æ®ç‚¹æ•°ã€‚å®šä¹‰ $J(w)=\frac{|W^TS_BW|}{|W^TS_wW|}$ ä¸ºç›®æ ‡å‡½æ•°ï¼Œå…¶ä¸­çŸ©é˜µ $W$ æ˜¯æŠ•å½±çŸ©é˜µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯è¦æ±‚å‡ºä½¿ $J(w)$ å–æœ€å¤§å€¼çš„æŠ•å½±çŸ©é˜µ $W$ ã€‚è¯¥æœ€å¤§å€¼å¯ç”±æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚å¾—ï¼Œä¸å†èµ˜è¿°ã€‚æœ€ç»ˆé—®é¢˜å¯åŒ–ç®€ä¸ºï¼Œ$S_w^{-1}S_Bw_i=Î»w_i$ ï¼Œå³æ±‚å¾—çŸ©é˜µçš„ç‰¹å¾å‘é‡ï¼Œç„¶åå–æŒ‰ç‰¹å¾å€¼ä»å¤§åˆ°å°æ’åˆ—çš„å‰ $k$ ä¸ªç‰¹å¾å‘é‡å³ä¸ºæ‰€éœ€çš„æŠ•å½±çŸ©é˜µã€‚

##### II. LDA ä¸ PCA çš„æ¯”è¾ƒ

- LDAä¸PCAç®—æ³•çš„**ä¸åŒ**ä¹‹å¤„ï¼š
  - ä»æ•°å­¦è§’åº¦æ¥çœ‹ï¼ŒLDAé€‰æ‹©åˆ†ç±»æ€§èƒ½æœ€å¥½çš„æŠ•å½±æ–¹å‘ï¼Œè€ŒPCAé€‰æ‹©æ ·æœ¬æŠ•å½±ç‚¹å…·æœ‰æœ€å¤§æ–¹å·®çš„æ–¹å‘ï¼›
  - LDAæ˜¯æœ‰ç›‘ç£çš„é™ç»´æ–¹æ³•ï¼Œè€ŒPCAæ˜¯æ— ç›‘ç£çš„ï¼›
  - å¯¹äº $K$ ç»´çš„æ•°æ®ï¼ŒLDAåªèƒ½å°†å…¶é™åˆ° $K-1$ ç»´åº¦ï¼Œè€Œ PCA ä¸å—æ­¤é™åˆ¶ã€‚

- LDAä¸PCAç®—æ³•çš„**ç›¸åŒ**ä¹‹å¤„ï¼š
  - åœ¨é™ç»´çš„æ—¶å€™ï¼Œä¸¤è€…éƒ½ä½¿ç”¨äº†çŸ©é˜µçš„ç‰¹å¾åˆ†è§£æ€æƒ³ï¼›
  - ä¸¤ç§ç®—æ³•éƒ½å‡è®¾æ•°æ®é›†ä¸­åŸå§‹æ•°æ®ç¬¦åˆé«˜æ–¯åˆ†å¸ƒã€‚

##### III. LDA çš„ python å®ç°

> ç”¨pythonè¯­è¨€å®ç°ä¸Šè¿°ç®—æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼Œä»…å±•ç¤ºä»£ç æ ¸å¿ƒéƒ¨åˆ†ï¼Œè¯¦ç»†ä»£ç **è¯·è§é™„ä»¶**ã€‚
>
> å‚è€ƒé“¾æ¥ï¼š[ã€Šäººè„¸è¯†åˆ«ç»å…¸ç®—æ³•å®ç°ï¼ˆäºŒï¼‰â€”â€”Fisherçº¿æ€§åˆ¤åˆ«åˆ†æã€‹](https://blog.csdn.net/freedom098/article/details/52088135)ï¼Œ[ã€Šopencvå­¦ä¹ ä¹‹è·¯ï¼ˆ40ï¼‰ã€äººè„¸è¯†åˆ«ç®—æ³•â€”â€”EigenFaceã€FisherFaceã€LBPHã€‹](https://www.cnblogs.com/little-monkey/p/8118938.html)ï¼Œ[ã€Šç»å…¸äººè„¸è¯†åˆ«ç®—æ³•å°ç»“â€”â€”EigenFace, FisherFace & LBPHï¼ˆä¸‹ï¼‰ã€‹](https://blog.csdn.net/kuweicai/article/details/79330524?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase)

```python
def algorithm_lda(data_list):
    """
    å¤šåˆ†ç±»é—®é¢˜çš„çº¿æ€§åˆ¤åˆ«åˆ†æç®—æ³•
    :param data_list: æ ·æœ¬çŸ©é˜µåˆ—è¡¨
    :return: å˜æ¢åçš„çŸ©é˜µåˆ—è¡¨å’Œå˜æ¢çŸ©é˜µ
    """
    n = data_list[0].shape[0]
    Sw = np.zeros((n, n))
    u = np.zeros((n, 1))
    Sb = np.zeros((n, n))
    N = 0
    mean_list = []
    sample_num = []

    for data_mat in data_list:
        mean_mat = np.mat(np.mean(data_mat, 1)).T
        mean_list.append(mean_mat)
        sample_num.append(data_mat.shape[1])
        data_mat = data_mat - mean_mat
        Sw += data_mat * data_mat.T

    for index, mean_mat in enumerate(mean_list):
        m = sample_num[index]
        u += m * mean_mat
        N += m
    u = u / N

    for index, mean_mat in enumerate(mean_list):
        m = sample_num[index]
        sb = m * (mean_mat - u) * (mean_mat - u).T
        Sb += sb

    eig_vals, eig_vecs = np.linalg.eig(np.mat(np.linalg.inv(Sw) * Sb))
    eig_vecs = eig_vecs / np.linalg.norm(eig_vecs, axis=0)
    eig_val = (np.argsort(eig_vals)[::-1])[:DIM]
    eig_vec = eig_vecs[:, eig_val]

    trans_mat_list = []
    for data_mat in data_list:
        trans_mat_list.append(eig_vec.T * data_mat)
    return trans_mat_list, eig_vec
```

### 3. ä¼ ç»Ÿç®—æ³•â€”â€”å±€éƒ¨äºŒè¿›åˆ¶æ¨¡å¼ç›´æ–¹å›¾ï¼ˆLBPHï¼‰

> LBPHç®—æ³•â€œäººâ€å¦‚å…¶åï¼Œé‡‡ç”¨çš„è¯†åˆ«æ–¹æ³•æ˜¯å±€éƒ¨ç‰¹å¾æå–çš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸å‰ä¸¤ç§æ–¹æ³•çš„æœ€å¤§åŒºåˆ«ã€‚ç±»ä¼¼çš„å±€éƒ¨ç‰¹å¾æå–ç®—æ³•è¿˜æœ‰ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDCTï¼‰ä¸ç›–ä¼¯å°æ³¢ï¼ˆGabor Waeletsï¼‰ç­‰ã€‚

â€‹	**LBPHï¼ˆLocal Binary Pattern Histogramsï¼Œå±€éƒ¨äºŒè¿›åˆ¶æ¨¡å¼ç›´æ–¹å›¾ï¼‰**äººè„¸è¯†åˆ«æ–¹æ³•çš„æ ¸å¿ƒæ˜¯ **LBPç®—å­**ã€‚LBPæ˜¯ä¸€ç§ç”¨æ¥æè¿°å›¾åƒå±€éƒ¨çº¹ç†ç‰¹å¾çš„ç®—å­ï¼Œå®ƒåæ˜ å†…å®¹æ˜¯æ¯ä¸ªåƒç´ ä¸å‘¨å›´åƒç´ çš„å…³ç³»ã€‚

##### I. LBP çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> å‚è€ƒé“¾æ¥ï¼š[ã€ŠLBPç®€ä»‹ã€‹](https://blog.csdn.net/pi9nc/article/details/18623971)ï¼Œ[ã€Šäººè„¸è¯†åˆ«ç»å…¸ç®—æ³•äºŒï¼šLBPæ–¹æ³•ã€‹](https://blog.csdn.net/feirose/article/details/39552977)

- åŸå§‹ LBP

  â€‹	æœ€åˆçš„LBPæ˜¯å®šä¹‰åœ¨åƒç´ 3x3é‚»åŸŸå†…çš„ï¼Œä»¥é‚»åŸŸä¸­å¿ƒåƒç´ ä¸ºé˜ˆå€¼ï¼Œå°†ç›¸é‚»çš„8ä¸ªåƒç´ çš„ç°åº¦å€¼ä¸å…¶è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥å‘¨å›´åƒç´ å€¼å¤§äºä¸­å¿ƒåƒç´ å€¼ï¼Œåˆ™è¯¥åƒç´ ç‚¹çš„ä½ç½®è¢«æ ‡è®°ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚è¿™æ ·ï¼Œ3x3é‚»åŸŸå†…çš„8ä¸ªç‚¹ç»æ¯”è¾ƒå¯äº§ç”Ÿ8ä½äºŒè¿›åˆ¶æ•°ï¼ˆé€šå¸¸è½¬æ¢ä¸ºåè¿›åˆ¶æ•°å³LBPç ï¼Œå…±256ç§ï¼‰ï¼Œå³å¾—åˆ°è¯¥é‚»åŸŸä¸­å¿ƒåƒç´ ç‚¹çš„LBPå€¼ï¼Œå¹¶ç”¨è¿™ä¸ªå€¼æ¥åæ˜ è¯¥åŒºåŸŸçš„çº¹ç†ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

  ![image-20200528204656131](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200528204656131.png)

- å‡åŒ€ LBPï¼ˆæœ¬æ¬¡ä½œä¸šä¸­ä»£ç é‡‡ç”¨çš„LBPç®—å­ï¼‰

  â€‹	ç ”ç©¶è€…å‘ç°æ ¹æ®åŸå§‹LBPè®¡ç®—å‡ºæ¥çš„90%ä»¥ä¸Šçš„å€¼å…·æœ‰æŸç§ç‰¹æ€§ï¼Œå³å±äº å‡åŒ€æ¨¡å¼ï¼ˆUniform Patternï¼‰â€”â€”äºŒè¿›åˆ¶åºåˆ—ï¼ˆè¿™ä¸ªäºŒè¿›åˆ¶åºåˆ—é¦–å°¾ç›¸è¿ï¼‰ä¸­æ•°å­—ä»0åˆ°1æˆ–æ˜¯ä»1åˆ°0çš„å˜åŒ–ä¸è¶…è¿‡2æ¬¡ã€‚æ¯”å¦‚ï¼Œ`01011111`çš„å˜åŒ–æ¬¡æ•°ä¸º3æ¬¡ï¼Œé‚£ä¹ˆè¯¥åºåˆ—ä¸å±äºå‡åŒ€æ¨¡å¼ã€‚æ ¹æ®è¿™ä¸ªç®—æ³•ï¼Œæ‰€æœ‰çš„8ä½äºŒè¿›åˆ¶æ•°ä¸­å…±æœ‰58ï¼ˆå˜åŒ–æ¬¡æ•°ä¸º0çš„æœ‰2ç§ï¼Œå˜åŒ–æ¬¡æ•°ä¸º1çš„æœ‰0ç§ï¼Œå˜åŒ–æ¬¡æ•°ä¸º2çš„æœ‰56ç§ï¼‰ä¸ªå‡åŒ€æ¨¡å¼ã€‚

  â€‹	æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸€æ•°æ®åˆ†å¸ƒç‰¹ç‚¹å°†åŸå§‹çš„LBPå€¼åˆ†ä¸º59ç±»ï¼Œ58ä¸ªå‡åŒ€æ¨¡å¼ä¸ºä¸€ç±»ï¼Œå…¶ä½™ä¸ºç¬¬59ç±»ã€‚è¿™æ ·å°±å°†ç›´æ–¹å›¾ä»åŸæ¥çš„256ç»´å˜æˆäº†59ç»´ï¼Œèµ·åˆ°äº†é™ç»´çš„æ•ˆæœã€‚

##### III. LBPH çš„ç®—æ³•æµç¨‹

LBPHçš„ç®—æ³•å…¶å®éå¸¸ç®€å•ï¼Œåªæœ‰ä¸¤æ­¥ï¼š

- LBPç‰¹å¾æå–ï¼šæ ¹æ®ä¸Šè¿°çš„å‡åŒ€LBPç®—å­å¤„ç†åŸå§‹å›¾åƒï¼›
- LBPç‰¹å¾åŒ¹é…ï¼ˆè®¡ç®—ç›´æ–¹å›¾ï¼‰ï¼šå°†å›¾åƒåˆ†ä¸ºè‹¥å¹²ä¸ªçš„å­åŒºåŸŸï¼Œå¹¶åœ¨å­åŒºåŸŸå†…æ ¹æ®LBPå€¼ç»Ÿè®¡å…¶ç›´æ–¹å›¾ï¼Œä»¥ç›´æ–¹å›¾ä½œä¸ºå…¶åˆ¤åˆ«ç‰¹å¾ã€‚

##### III. LBP çš„ç‰¹ç‚¹ï¼Ÿ

â€‹	LBPçš„ä¼˜ç‚¹æ˜¯å¯¹å…‰ç…§ä¸æ•æ„Ÿã€‚æ ¹æ®ç®—æ³•ï¼Œæ¯ä¸ªåƒç´ éƒ½ä¼šæ ¹æ®é‚»åŸŸä¿¡æ¯å¾—åˆ°ä¸€ä¸ªLBPå€¼ï¼Œå¦‚æœä»¥å›¾åƒçš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥å¯ä»¥å¾—åˆ°ä¸‹å›¾ã€‚ç›¸æ¯”äºPCAæˆ–è€…LDAç›´æ¥ä½¿ç”¨ç°åº¦å€¼å»å‚ä¸è¿ç®—ï¼ŒLBPç®—å­æ˜¯ä¸€ç§ç›¸å¯¹æ€§è´¨çš„æ•°é‡å…³ç³»ï¼Œè¿™æ˜¯LBPåº”å¯¹ä¸åŒå…‰ç…§æ¡ä»¶ä¸‹äººè„¸è¯†åˆ«åœºæ™¯çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚ä½†æ˜¯å¯¹äºä¸åŒè§’åº¦ã€é®æŒ¡ç­‰åœºæ™¯ï¼ŒLBPä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚

![image-20200528212302668](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200528212302668.png)

##### IV. LBPH çš„ python å®ç°

> ç”¨pythonè¯­è¨€å®ç°ä¸Šè¿°ç®—æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼Œä»…å±•ç¤ºä»£ç æ ¸å¿ƒéƒ¨åˆ†ï¼Œè¯¦ç»†ä»£ç **è¯·è§é™„ä»¶**ã€‚
>
> å‚è€ƒé“¾æ¥ï¼š[ã€Šäººè„¸è¯†åˆ«ç»å…¸ç®—æ³•å®ç°ï¼ˆä¸‰ï¼‰â€”â€”LBPç®—æ³•ã€‹](https://blog.csdn.net/freedom098/article/details/52088179)ï¼Œ[ã€Šopencvå­¦ä¹ ä¹‹è·¯ï¼ˆ40ï¼‰ã€äººè„¸è¯†åˆ«ç®—æ³•â€”â€”EigenFaceã€FisherFaceã€LBPHã€‹](https://www.cnblogs.com/little-monkey/p/8118938.html)ï¼Œ[ã€Šç»å…¸äººè„¸è¯†åˆ«ç®—æ³•å°ç»“â€”â€”EigenFace, FisherFace & LBPHï¼ˆä¸‹ï¼‰ã€‹](https://blog.csdn.net/kuweicai/article/details/79330524?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7.nonecase)

```python
class AlgorithmLbp(object):
    def load_img_list(self, dir_name):
        """
        åŠ è½½å›¾åƒçŸ©é˜µåˆ—è¡¨
        :param dir_name:æ–‡ä»¶å¤¹è·¯å¾„
        :return: åŒ…å«æœ€åŸå§‹çš„å›¾åƒçŸ©é˜µçš„åˆ—è¡¨å’Œæ ‡ç­¾çŸ©é˜µ
        """
        # è¯·è§é™„ä»¶

    def get_hop_counter(self, num):
        """
        è®¡ç®—äºŒè¿›åˆ¶åºåˆ—æ˜¯å¦åªå˜åŒ–ä¸¤æ¬¡
        :param num: æ•°å­—
        :return: 01å˜åŒ–æ¬¡æ•°
        """
        bin_num = bin(num)
        bin_str = str(bin_num)[2:]
        n = len(bin_str)
        if n < 8:
            bin_str = "0" * (8 - n) + bin_str
        n = len(bin_str)
        counter = 0
        for i in range(n):
            if i != n - 1:
                if bin_str[i + 1] != bin_str[i]:
                    counter += 1
            else:
                if bin_str[0] != bin_str[i]:
                    counter += 1
        return counter

    def get_table(self):
        """
        ç”Ÿæˆå‡åŒ€å¯¹åº”å­—å…¸
        :return: å‡åŒ€LBPç‰¹å¾å¯¹åº”å­—å…¸
        """
        counter = 1
        for i in range(256):
            if self.get_hop_counter(i) <= 2:
                self.table[i] = counter
                counter += 1
            else:
                self.table[i] = 0
        return self.table

    def get_lbp_feature(self, img_mat):
        """
        è®¡ç®—LBPç‰¹å¾
        :param img_mat:å›¾åƒçŸ©é˜µ
        :return: LBPç‰¹å¾å›¾
        """
        m = img_mat.shape[0]
        n = img_mat.shape[1]
        neighbor = [0] * 8
        feature_map = np.mat(np.zeros((m, n)))
        for y in range(1, m - 1):
            for x in range(1, n - 1):
                neighbor[0] = img_mat[y - 1, x - 1]
                neighbor[1] = img_mat[y - 1, x]
                neighbor[2] = img_mat[y - 1, x + 1]
                neighbor[3] = img_mat[y, x + 1]
                neighbor[4] = img_mat[y + 1, x + 1]
                neighbor[5] = img_mat[y + 1, x]
                neighbor[6] = img_mat[y + 1, x - 1]
                neighbor[7] = img_mat[y, x - 1]
                center = img_mat[y, x]
                temp = 0
                for k in range(8):
                    temp += (neighbor[k] >= center) * (1 << k)
                feature_map[y, x] = self.table[temp]
        feature_map = feature_map.astype('uint8') 
        return feature_map

    def get_hist(self, roi):
        """
        è®¡ç®—ç›´æ–¹å›¾
        :param roi:å›¾åƒåŒºåŸŸ
        :return: ç›´æ–¹å›¾çŸ©é˜µ
        """
        hist = cv2.calcHist([roi], [0], None, [59], [0, 256]) 
        return hist
```

### 4. ç¥ç»ç½‘ç»œâ€”â€”å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰

â€‹	**CNNï¼ˆConvolutional Neural Networksï¼Œå·ç§¯ç¥ç»ç½‘ç»œï¼‰**æ˜¯äººè„¸è¯†åˆ«æ–¹é¢æœ€å¸¸ç”¨çš„ä¸€ç±»æ·±åº¦å­¦ä¹ æ–¹æ³•ã€‚æ·±åº¦å­¦ä¹ æ–¹æ³•çš„ä¸»è¦ä¼˜åŠ¿æ˜¯å¯ç”¨å¤§é‡æ•°æ®æ¥è®­ç»ƒï¼Œä»è€Œå­¦åˆ°å¯¹è®­ç»ƒæ•°æ®ä¸­å‡ºç°çš„å˜åŒ–æƒ…å†µç¨³å¥çš„äººè„¸è¡¨å¾ã€‚è¿™ç§æ–¹æ³•ä¸éœ€è¦è®¾è®¡å¯¹ä¸åŒç±»å‹çš„ç±»å†…å·®å¼‚ï¼ˆæ¯”å¦‚å…‰ç…§ã€å§¿åŠ¿ã€é¢éƒ¨è¡¨æƒ…ã€å¹´é¾„ç­‰ï¼‰ç¨³å¥çš„ç‰¹å®šç‰¹å¾ï¼Œè€Œæ˜¯å¯ä»¥ä»è®­ç»ƒæ•°æ®ä¸­å­¦åˆ°å®ƒä»¬ã€‚

â€‹	æ·±åº¦å­¦ä¹ æ–¹æ³•çš„ä¸»è¦çŸ­æ¿æ˜¯å®ƒä»¬éœ€è¦ä½¿ç”¨éå¸¸å¤§çš„æ•°æ®é›†æ¥è®­ç»ƒï¼Œè€Œä¸”è¿™äº›æ•°æ®é›†ä¸­éœ€è¦åŒ…å«è¶³å¤Ÿçš„å˜åŒ–ï¼Œä»è€Œå¯ä»¥æ³›åŒ–åˆ°æœªæ›¾è§è¿‡çš„æ ·æœ¬ä¸Šã€‚å¹¸è¿çš„æ˜¯ï¼Œä¸€äº›åŒ…å«è‡ªç„¶äººè„¸å›¾åƒçš„å¤§è§„æ¨¡äººè„¸æ•°æ®é›†å·²è¢«å…¬å¼€ï¼›ä¸å¹¸çš„æ˜¯ï¼Œæœ¬äººè®¾å¤‡ç®—åŠ›å®åœ¨æœ‰é™ï¼Œæ— æ³•æ”¯æŒåœ¨å¤§æ•°æ®é›†ä¸Šè¿è¡Œæ·±åº¦å­¦ä¹ ä»£ç ã€‚

##### I.  æ·±åº¦å­¦ä¹ çš„å‡ ä¸ªç»å…¸çš„æ¡ˆä¾‹

> å‚è€ƒé“¾æ¥ï¼š[ã€Šäººè„¸è¯†åˆ«åˆé›† | ç»ªè®ºä¸ç›®å½•ã€‹](https://zhuanlan.zhihu.com/p/76511732)ï¼Œ[ã€ŠFace Recognition: From Traditional to Deep Learning Methodsã€‹](https://arxiv.org/abs/1811.00116)

- DeepFaceï¼Œ2014å¹´

  â€‹	DeepFaceä¸»è¦å…ˆè®­ç»ƒSoftmaxå¤šåˆ†ç±»å™¨äººè„¸è¯†åˆ«æ¡†æ¶ï¼›ç„¶åæŠ½å–ç‰¹å¾å±‚ï¼Œç”¨ç‰¹å¾å†è®­ç»ƒå¦ä¸€ä¸ªç¥ç»ç½‘ç»œã€å­ªç”Ÿç½‘ç»œæˆ–ç»„åˆè´å¶æ–¯ç­‰äººè„¸éªŒè¯æ¡†æ¶ã€‚æƒ³åŒæ—¶æ‹¥æœ‰äººè„¸éªŒè¯å’Œäººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œéœ€è¦åˆ†å¼€è®­ç»ƒä¸¤ä¸ªç¥ç»ç½‘ç»œã€‚ä½†çº¿æ€§å˜æ¢çŸ©é˜µWçš„å¤§å°éšç€èº«ä»½æ•°é‡nçš„å¢åŠ è€Œçº¿æ€§å¢å¤§ã€‚

  â€‹	DeepFaceçš„ä¸»è¦è´¡çŒ®æ˜¯ï¼Œï¼ˆ1ï¼‰ä¸€ä¸ªåŸºäºæ˜ç¡®çš„ 3D äººè„¸å»ºæ¨¡çš„é«˜æ•ˆçš„äººè„¸å¯¹é½ç³»ç»Ÿï¼›ï¼ˆ2ï¼‰ä¸€ä¸ªåŒ…å«å±€éƒ¨è¿æ¥çš„å±‚çš„ CNN æ¶æ„ ï¼Œè¿™äº›å±‚ä¸åŒäºå¸¸è§„çš„å·ç§¯å±‚ï¼Œå¯ä»¥ä»å›¾åƒä¸­çš„æ¯ä¸ªåŒºåŸŸå­¦åˆ°ä¸åŒçš„ç‰¹å¾ã€‚

- DeepIDç³»åˆ—ï¼Œ2014å¹´

  â€‹	DeepIDæ¡†æ¶ä¸DeepFaceç±»ä¼¼ï¼Œé‡‡ç”¨çš„æ˜¯ CNN+Softmaxï¼›è€ŒDeepID2ã€DeepID2+ã€DeepID3éƒ½é‡‡ç”¨ CNN+Softmax+Contrastive Lossï¼Œä½¿å¾—åŒç±»ç‰¹å¾çš„L2è·ç¦»å°½å¯èƒ½å°ï¼Œä¸åŒç±»ç‰¹å¾çš„L2è·ç¦»å¤§äºæŸä¸ªé—´éš”ã€‚

- FaceNetï¼Œ2015å¹´

  â€‹	2015å¹´FaceNetæå‡ºäº†ä¸€ä¸ªç»å¤§éƒ¨åˆ†äººè„¸é—®é¢˜çš„ç»Ÿä¸€è§£å†³æ¡†æ¶ï¼Œç›´æ¥å­¦ä¹ åµŒå…¥ç‰¹å¾ï¼Œç„¶åäººè„¸è¯†åˆ«ã€äººè„¸éªŒè¯å’Œäººè„¸èšç±»ç­‰éƒ½åŸºäºè¿™ä¸ªç‰¹å¾æ¥åšã€‚FaceNetåœ¨ DeepID2 çš„åŸºç¡€ä¸Šï¼ŒæŠ›å¼ƒäº†åˆ†ç±»å±‚ï¼Œå†å°† Contrastive Loss æ”¹è¿›ä¸º Triplet Lossï¼Œè·å¾—ç±»å†…ç´§å‡‘å’Œç±»é—´å·®å¼‚ã€‚ä½†äººè„¸ä¸‰å…ƒç»„çš„æ•°é‡å‡ºç°çˆ†ç‚¸å¼å¢é•¿ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§å‹æ•°æ®é›†ï¼Œå¯¼è‡´è¿­ä»£æ¬¡æ•°æ˜¾è‘—å¢åŠ ï¼›æ ·æœ¬æŒ–æ˜ç­–ç•¥é€ æˆå¾ˆéš¾æœ‰æ•ˆçš„è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒã€‚

##### II. æ·±åº¦å­¦ä¹ çš„ç®—æ³•æµç¨‹

> å‚è€ƒé“¾æ¥ï¼š[ã€Šäººè„¸è¯†åˆ«åˆé›† | äººè„¸è¯†åˆ«æ¦‚è¿°ã€‹](https://zhuanlan.zhihu.com/p/76513217)ï¼Œ[ã€ŠFace Recognition: From Traditional to Deep Learning Methodsã€‹](https://arxiv.org/abs/1811.00116)

â€‹	ç”¨äºäººè„¸è¯†åˆ«çš„ CNN æ¨¡å‹ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§è®¾è®¡æ€è·¯ï¼š

- åŸºäº**åº¦é‡**çš„å­¦ä¹ ï¼šé€šè¿‡ä¼˜åŒ–é…å¯¹çš„äººè„¸æˆ–äººè„¸ä¸‰å…ƒç»„ä¹‹é—´çš„è·ç¦»åº¦é‡æ¥ç›´æ¥å­¦ä¹ äººè„¸è¡¨å¾ï¼ˆå¸¸ç§°ä¸ºç“¶é¢ˆç‰¹å¾ï¼Œbottleneck featuresï¼‰ï¼›
- åŸºäº**åˆ†ç±»**çš„å­¦ä¹ ï¼šè®­ç»ƒé›†ä¸­çš„æ¯ä¸ªä¸»ä½“éƒ½å¯¹åº”ä¸€ä¸ªç±»åˆ«ï¼Œé€šè¿‡å»é™¤åˆ†ç±»å±‚å¹¶å°†ä¹‹å‰å±‚çš„ç‰¹å¾ç”¨ä½œç“¶é¢ˆç‰¹å¾è€Œå°†è¯¥æ¨¡å‹ç”¨äºè¯†åˆ«ä¸å­˜åœ¨äºè®­ç»ƒé›†ä¸­çš„ä¸»ä½“ã€‚åœ¨è¿™ç¬¬ä¸€ä¸ªè®­ç»ƒé˜¶æ®µä¹‹åï¼Œè¯¥æ¨¡å‹å¯ä»¥ä½¿ç”¨å…¶å®ƒæŠ€æœ¯æ¥è¿›ä¸€æ­¥è®­ç»ƒï¼Œä»è€Œä¸ºç›®æ ‡åº”ç”¨ä¼˜åŒ–ç“¶é¢ˆç‰¹å¾ï¼ˆæ¯”å¦‚ä½¿ç”¨è”åˆè´å¶æ–¯æˆ–ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„æŸå¤±å‡½æ•°æ¥å¾®è°ƒè¯¥ CNN æ¨¡å‹ ï¼‰ã€‚

![image-20200529095549533](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529095549533.png)

##### III. Pythonå®ç° 

> **å·ç§¯ç¥ç»ç½‘ç»œéƒ¨åˆ†çš„ä»£ç éæœ¬äººç¼–å†™ï¼Œå¸Œæœ›è€å¸ˆä¸åŠ©æ•™çŸ¥æ‚‰ã€‚[ã€å¼•ç”¨åœ°å€ã€‘](https://github.com/Jay1Zhang/BUAAIPPR-homework3-FaceRecognition)**

â€‹	ä¸ç”µè„‘ç¯å¢ƒæ–—äº‰ä¸€å¤©çš„æˆ‘ï¼Œé¢å¯¹æ— æ•°çš„DDLï¼Œé‚é€‰æ‹©æç½®ï¼Œæ—¥åæˆ‘ä¼šå°†é‡æ–°ç¼–å†™çš„ä»£ç æ”¾åœ¨[**æˆ‘çš„åšå®¢**](https://www.cnblogs.com/FUJI-Mount/)ä¸­ã€‚ä½†ä¸ºäº†ä½¿æŠ¥å‘Šæ›´åŠ å®Œæ•´ï¼Œ**å…¼é¡¾ä¼ ç»Ÿæ–¹æ³•ä¸æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œç»¼åˆå¯¹æ¯”ä¸åŒæ–¹æ³•åœ¨äººè„¸è¯†åˆ«ä¸­çš„è¡¨ç°**ï¼Œæˆ‘ä½¿ç”¨äº† **17373489 å¼ ä½³ä¸€** åŒå­¦çš„ **CNN ä»£ç ä¸æ•°æ®**ï¼ˆè§ç»“æœåˆ†æéƒ¨åˆ†ï¼‰ã€‚

```python
#å®ç°CNNå·ç§¯ç¥ç»ç½‘ç»œï¼Œå¹¶æµ‹è¯•æœ€ç»ˆè®­ç»ƒæ ·æœ¬å®ç°çš„æ£€æµ‹æ¦‚ç‡
#tf.layeræ–¹æ³•å¯ä»¥ç›´æ¥å®ç°ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œçš„æ­å»º
#é€šè¿‡å·ç§¯æ–¹æ³•å®ç°
layer1 = tf.layers.conv2d(inputs=data_input, filters = 32,kernel_size=2,
strides=1,padding='SAME',activation=tf.nn.relu)
#å®ç°æ± åŒ–å±‚ï¼Œå‡å°‘æ•°æ®é‡ï¼Œpool_size=2è¡¨ç¤ºæ•°æ®é‡å‡å°‘ä¸€åŠ
layer1_pool = tf.layers.max_pooling2d(layer1,pool_size=2,strides=2)
#ç¬¬äºŒå±‚è®¾ç½®è¾“å‡ºï¼Œå®Œæˆç»´åº¦çš„è½¬æ¢ï¼Œä»¥ç¬¬ä¸€æ¬¡è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå»ºç«‹nè¡Œçš„32*32*32è¾“å‡º
layer2 = tf.reshape(layer1_pool,[-1,32*32*32])
#è®¾ç½®è¾“å‡ºæ¿€åŠ±å‡½æ•°
layer2_relu = tf.layers.dense(layer2, 1024, tf.nn.relu)
#å®Œæˆè¾“å‡ºï¼Œè®¾ç½®è¾“å…¥æ•°æ®å’Œè¾“å‡ºç»´åº¦
output = tf.layers.dense(layer2_relu, num_people)
#å»ºç«‹æŸå¤±å‡½æ•°
loss =
tf.losses.softmax_cross_entropy(onehot_labels=label_input,logits=output)
#ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œè®­ç»ƒ
train = tf.train.GradientDescentOptimizer(0.01).minimize(loss)
#å®šä¹‰æ£€æµ‹æ¦‚ç‡
accuracy = tf.metrics.accuracy(
labels=tf.arg_max(label_input, 1), predictions=tf.arg_max(output, 1))
[1]
```

## ç»“æœåˆ†æ

### 0. æ•°æ®é›†è¯´æ˜

##### I. åŸºæœ¬ä¿¡æ¯ï¼ˆ[æ•°æ®é›†åœ°å€](https://bhpan.buaa.edu.cn:443/link/F6494CE01093C0684823ADFE37DFF6C2)ï¼‰

- æ•°æ®é›†ä¸­å…±åŒ…å«395äººï¼ˆç”·æ€§å’Œå¥³æ€§ï¼‰çš„äººè„¸å›¾åƒï¼Œæ¯äºº20å¼ å›¾åƒï¼›
- æ•°æ®é›†ä¸­äººæ¥è‡ªä¸åŒç§æ—ï¼ˆä½†é²œæœ‰ä¸œæ–¹äººï¼‰ï¼›
- ä¸»è¦æ˜¯å¤§å­¦ä¸€å¹´çº§çš„æœ¬ç§‘ç”Ÿï¼Œæ•…å¤§å¤šæ•°çš„ä¸ªä½“åœ¨18-20å²ä¹‹é—´ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å¹´é¾„è¾ƒå¤§çš„ä¸ªä½“ï¼›
- æ•°æ®é›†åˆ’åˆ†ä¸ºå››ä¸ªå­é›†ï¼Œåˆ†åˆ«ä¸ºFaces94ã€Faces95ã€Faces96ä»¥åŠGrimaceï¼Œè¯†åˆ«éš¾åº¦é€’å¢ã€‚

##### II. æ•°æ®é›†å±•ç¤º

|                       Faces94ï¼ˆ153äººï¼‰                       |                       Faces95ï¼ˆ72äººï¼‰                        |                       Faces96ï¼ˆ152äººï¼‰                       |                       Grimaceï¼ˆ18äººï¼‰                        |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![anonym2.2](https://gitee.com/FujiW/FigureBed/raw/master/img/anonym2.2.jpg) | ![adhast.2](https://gitee.com/FujiW/FigureBed/raw/master/img/adhast.2.jpg) | ![9540547.2](https://gitee.com/FujiW/FigureBed/raw/master/img/9540547.2.jpg) | ![mike_exp.2](https://gitee.com/FujiW/FigureBed/raw/master/img/mike_exp.2.jpg) |
| ![cchris.14](https://gitee.com/FujiW/FigureBed/raw/master/img/cchris.14.jpg) | ![jross.20](https://gitee.com/FujiW/FigureBed/raw/master/img/jross.20.jpg) | ![gghazv.1](https://gitee.com/FujiW/FigureBed/raw/master/img/gghazv.1.jpg) | ![ant_exp.13](https://gitee.com/FujiW/FigureBed/raw/master/img/ant_exp.13.jpg) |

### 1. ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰

##### I. PCAç®—æ³•ä¸­çš„ â€œå¹³å‡è„¸â€ ä¸ â€œç‰¹å¾è„¸â€

> åœ¨ä»£ç å®ç°éƒ¨åˆ†ï¼Œæˆ‘å°† **å‡å€¼çŸ©é˜µ** ä¸ **ç‰¹å¾çŸ©é˜µ** é‡æ–°æ˜ å°„åˆ° $[0,255]$ çš„ç°åº¦å€¼åŒºé—´ï¼Œå¾—åˆ°äº†æ‰€è°“ â€œå¹³å‡è„¸â€ ä¸ â€œç‰¹å¾è„¸â€ã€‚ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼Œä¾æ¬¡ä¸ºåœ¨ Faces94ã€Faces95ã€Faces96ã€Grimaceçš„ç»“æœï¼‰

| ![image-20200529153451265](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529153451265.png) | ![image-20200529153637277](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529153637277.png) | ![image-20200529153604493](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529153604493.png) | ![image-20200529153520283](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529153520283.png) | ![image-20200529153423698](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529153423698.png) |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                          **å¹³å‡è„¸**                          |                           ç‰¹å¾è„¸ 1                           |                           ç‰¹å¾è„¸ 2                           |                          ç‰¹æœ—æ™® 3 ğŸ˜œ                          |                           ç‰¹å¾è„¸ 4                           |

| ![image-20200529160618129](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160618129.png) | ![image-20200529160719210](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160719210.png) | ![image-20200529160701992](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160701992.png) | ![image-20200529160743278](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160743278.png) | ![image-20200529160802233](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160802233.png) |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                          **å¹³å‡è„¸**                          |                           ç‰¹å¾è„¸ 1                           |                           ç‰¹å¾è„¸ 2                           |                           ç‰¹å¾è„¸ 3                           |                           ç‰¹å¾è„¸ 4                           |

| ![image-20200529162005906](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529162005906.png) | ![image-20200529162025283](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529162025283.png) | ![image-20200529162042848](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529162042848.png) | ![image-20200529162107583](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529162107583.png) | ![image-20200529162142207](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529162142207.png) |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                          **å¹³å‡è„¸**                          |                           ç‰¹å¾è„¸ 1                           |                           ç‰¹å¾è„¸ 2                           |                           ç‰¹å¾è„¸ 3                           |                           ç‰¹å¾è„¸ 4                           |

| ![image-20200529160132783](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160132783.png) | ![image-20200529160211493](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160211493.png) | ![image-20200529160239724](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160239724.png) | ![image-20200529160300530](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160300530.png) | ![image-20200529160317587](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529160317587.png) |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                          **å¹³å‡è„¸**                          |                           ç‰¹å¾è„¸ 1                           |                           ç‰¹å¾è„¸ 2                           |                           ç‰¹å¾è„¸ 3                           |                           ç‰¹å¾è„¸ 4                           |

##### II. å‡†ç¡®ç‡ä¸æ¶ˆè€—æ—¶é—´

> è¿™é‡Œå±•ç¤ºçš„æ˜¯è¯¥ç®—æ³•åœ¨ä¸åŒæ•°æ®é›†ä¸Šè¯†åˆ«çš„å‡†ç¡®ç‡ï¼Œä»¥åŠåœ¨æœ¬æœºä¸Šè¿è¡Œçš„æ—¶é—´ï¼ˆå•ä½ï¼šmsï¼‰ã€‚

|                           Faces94                            |                           Faces95                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200529154316549](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529154316549.png) | ![image-20200529154440399](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529154440399.png) |

|                           Faces96                            |                           Grimace                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200529155813754](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529155813754.png) | ![image-20200529155905364](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529155905364.png) |

##### III. PCA ç»“æœåˆ†æ

- å‡†ç¡®ç‡æ–¹é¢ï¼šæˆ‘ä»¬å‘ç°ï¼ŒPCAåœ¨Faces94ä¸Grimaceä¸Šçš„è¯†åˆ«å‡†ç¡®ç‡ç«Ÿç„¶è¾¾åˆ°äº†100%ï¼ŒFaces96ä¸Šæ¬¡ä¹‹ï¼Œè€Œåœ¨Faces95ä¸Šçš„è¯†åˆ«ç‡æœ€ä½ã€‚è¿™ä¸æˆ‘ä»¬çš„é¢„æœŸå¤§ç›¸å¾„åº­ã€‚ç»“åˆâ€œå¹³å‡è„¸â€ä¸æ•°æ®é›†ç‰¹å¾ï¼Œâ€”â€”Faces95æ•°æ®é›†ä¸­äººè„¸çš„è§’åº¦å˜åŒ–è¾ƒå¤§ï¼Œè€ŒFaces96ä¸­èƒŒæ™¯çš„å¹²æ‰°è¾ƒå¤§â€”â€”æˆ‘è®¤ä¸ºåº”è¯¥æ˜¯å› ä¸ºåœ¨ä»£ç å®ç°æ—¶ï¼Œæ•°æ®é¢„å¤„ç†ä¸­æ²¡æœ‰è¿›è¡Œè‰¯å¥½çš„äººè„¸æ£€æµ‹ä¸å¯¹é½ï¼Œè¿™ä¹Ÿåæ˜ äº†ï¼ŒPCAåœ¨é€‚åº”èƒŒæ™¯å¹²æ‰°ä¸äººè„¸è§’åº¦å˜åŒ–æ–¹é¢ï¼Œè¡¨ç°ä¸ä½³ï¼›

- è¯†åˆ«é€Ÿåº¦æ–¹é¢ï¼šéšæ•°æ®é›†è§„æ¨¡æ‰©å¤§ï¼Œè¯†åˆ«è€—æ—¶åŸºæœ¬å‘ˆæŒ‡æ•°å¢é•¿çš„è¶‹åŠ¿ï¼ˆæ©™è‰²è™šçº¿ä¸ºæŒ‡æ•°æ‹Ÿåˆæ›²çº¿ï¼‰ã€‚

  ![image-20200529213252667](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529213252667.png)

### 2. çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰

> ä»£ç è¿è¡Œåœ¨Faces94ä¸Faces95å­é›†ä¸Šä¼šå‡ºç°æ•°ç»„æº¢å‡ºçš„BUGï¼Œè¿™ä¸æ•°æ®é›†ä¸­éæ³•æ•°æ®ï¼ˆç±»åˆ«ä¸­ä¸è¶³20å¼ ï¼ŒåŒ…å«.gifå›¾ç‰‡ç­‰ï¼‰æœ‰å…³ï¼Œéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œè¿‡æ»¤ï¼Œç°ä»…åœ¨å…¶ä½™ä¸¤ä¸ªæ•°æ®é›†ä¸Šæµ‹è¯•ã€‚

##### I. LDAä¸­çš„å¹³å‡è„¸

|                           Faces96                            |                           Grimace                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200529172252635](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529172252635.png) | ![image-20200529173231579](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529173231579.png) |

##### II. å‡†ç¡®ç‡ä¸æ¶ˆè€—æ—¶é—´

|                           Faces96                            |                           Grimace                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200529165250674](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529165250674.png) | ![image-20200529173145839](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529173145839.png) |

##### III. LDA ç»“æœåˆ†æ

- å‡†ç¡®ç‡æ–¹é¢ï¼šå®éªŒç»“æœæ˜¾ç¤ºï¼ŒLDAåœ¨Faces96ä¸Šè¡¨ç°ä¸ä½³ï¼Œè€Œåœ¨Grimaceä¸Šåˆ™è¾¾åˆ°äº†100%è¯†åˆ«ã€‚åˆ†æå…¶åŸå› ï¼ŒLDAï¼›

- è¯†åˆ«é€Ÿåº¦æ–¹é¢ï¼šä¸PCAæŠ€æœ¯ç›¸æ¯”ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç›¸åŒçš„æ•°æ®é›†ä¸Šï¼ŒLDAç®—æ³•è€—æ—¶è¦æ¯”PCAé•¿ï¼Œä¸”å½“æ•°æ®é›†å¢å¤§æ—¶ï¼ŒLDAç®—æ³•è€—æ—¶ä¸PCAçš„å·®å€¼é€æ¸å¢å¤§ï¼›ä½†æ˜¯ï¼Œå½“æ•°æ®é›†è¾ƒå°æ—¶ï¼ŒLDAçš„é€Ÿåº¦åè€Œæ¯”PCAç•¥å¿«ã€‚

  ![image-20200530000757818](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530000757818.png)

### 3. å±€éƒ¨äºŒè¿›åˆ¶æ¨¡å¼ç›´æ–¹å›¾ï¼ˆLBPHï¼‰

##### I.  LBPH ä¸­é—´å›¾åƒ

> æ³¨æ„ï¼Œä¸ºäº†æé«˜è¯†åˆ«æ•ˆç‡ï¼Œåœ¨å›¾ç‰‡è¯»å–æ—¶ï¼Œæˆ‘å·²ç»å°†åŸå›¾å°ºå¯¸ç»Ÿä¸€è°ƒæ•´ä¸º 50 Ã— 50 ã€‚

|                             åŸå›¾                             |                           åŸå§‹LBP                            |                           å‡è¡¡æ¨¡å¼                           |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200529201746853](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529201746853.png) | ![image-20200529201838431](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529201838431.png) | ![image-20200529201934509](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200529201934509.png) |

##### II. å‡†ç¡®ç‡ä¸æ¶ˆè€—æ—¶é—´

> LBPHäººè„¸æ¯”å¯¹æ—¶é—´è¿‡é•¿ï¼Œåœ¨æµ‹è¯•æ—¶ï¼Œæˆ‘å°†å…¶è¯»å–åˆ°çš„å›¾ç‰‡è°ƒæ•´ä¸º20 Ã— 20ï¼Œä»¥æé«˜è¯†åˆ«é€Ÿåº¦ã€‚

|                           Faces94                            |                           Faces95                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200530163044671](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530163044671.png) | ![image-20200530173615958](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530173615958.png) |

|                           Faces96                            |                           Grimace                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200531004930294](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200531004930294.png) | ![image-20200531095639006](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200531095639006.png) |

##### III. ç»“æœåˆ†æ

- è¯†åˆ«å‡†ç¡®ç‡ä¸Šæ¥çœ‹ï¼ŒLBPHæ€»ä½“è¡¨ç°è¾ƒå¥½ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½è¡¨ç°è¾ƒå¥½ï¼Œå°¤å…¶æ˜¯åœ¨Faces94å’ŒGrimaceä¸Šå–å¾—è¾ƒå¥½çš„è¯†åˆ«æ•ˆæœï¼Œä½†æ˜¯åœ¨Faces95æ•°æ®é›†ä¸Šçš„è¯†åˆ«æ•ˆæœä¸ä½³ã€‚è¿™åº”è¯¥ä¸æˆ‘åœ¨å›¾ç‰‡å‹ç¼©æ—¶ï¼Œå°†å›¾ç‰‡ä» 180 Ã— 200 å‹ç¼©åˆ° 20 Ã— 20 æ‰€é€ æˆçš„å±€éƒ¨ä¿¡æ¯æŸå¤±æœ‰å…³ã€‚
- è¯†åˆ«é€Ÿåº¦ä¸Šæ¥çœ‹ï¼ŒLBPHçš„äººè„¸è¡¨å¾çš„æå–é˜¶æ®µè€—æ—¶è¾ƒçŸ­ï¼Œä½†æ˜¯äººè„¸è¯†åˆ«é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡è¯†åˆ«éƒ½è¦éå†è®­ç»ƒé›†ä¸­æ‰€æœ‰å›¾ç‰‡è¿›è¡Œè®¡ç®—ï¼ˆå¯ä»¥é€šè¿‡è°ƒæ•´å›¾ç‰‡å‹ç¼©æ¯”ä»¥åŠç›´æ–¹å›¾åˆ’å—çš„å¤§å°æ¥è°ƒæ•´è¯†åˆ«çš„æ—¶é—´å¤æ‚åº¦ï¼‰ã€‚

##### IV. ä¸‰ç§ç»å…¸ç®—æ³•çš„å‡†ç¡®ç‡å¯¹æ¯”

> ä¸åŒç®—æ³•ä¸‹ï¼Œåœ¨ä¸åŒç‰¹ç‚¹çš„æ•°æ®é›†ä¸­ï¼Œäººè„¸è¯†åˆ«å‡†ç¡®ç‡çš„å¯¹æ¯”å¦‚ä¸‹ã€‚

![image-20200531165302774](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200531165302774.png)

##### V. ä¸‰ç§ç»å…¸ç®—æ³•çš„é€Ÿåº¦å¯¹æ¯”

> è¿è¡Œç®—æ³•è¿›è¡Œäººè„¸è¡¨å¾æå–æ‰€éœ€æ—¶é—´ï¼ˆå•ä½ï¼šmsï¼‰ã€‚

![image-20200531164604346](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200531164604346.png)

> ä¸åŒç®—æ³•è¿›è¡Œäººè„¸è¯†åˆ«æ‰€éœ€æ—¶é—´ï¼ˆå•ä½ï¼šmsï¼‰ã€‚

![image-20200531170130094](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200531170130094.png)

### 4. å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼Œåˆ†ç±»æ¨¡å‹ï¼‰

> ç”¨åˆ°çš„æ•°æ®é›†ï¼š[PIE dataset](https://bhpan.buaa.edu.cn:443/link/F4C2558EF90F376821A9786B4ECA5212) ï¼ŒåŒ…å«äº†68ä¸ªäººåœ¨äº”ç§ä¸åŒå§¿æ€ä¸‹çš„å…±11554å¼ é¢éƒ¨å›¾åƒæ•°æ®ï¼Œå¹¶ä»¥MATæ ¼å¼çš„æ–‡ä»¶ä¿å­˜ã€‚

##### I. å‡†ç¡®ç‡ä¸æŸå¤±å‡½æ•°æ”¶æ•›æƒ…å†µ

|                            Pose07                            |                            Pose09                            |                            Pose27                            |                            Pose29                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20200530003146949](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530003146949.png) | ![image-20200530003156212](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530003156212.png) | ![image-20200530003203409](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530003203409.png) | ![image-20200530003210152](https://gitee.com/FujiW/FigureBed/raw/master/img/image-20200530003210152.png) |

##### II. åˆ†æï¼ˆä¸ç»å…¸ç®—æ³•çš„å¯¹æ¯”ï¼‰

- æˆ‘ä»¬å‘ç°ï¼Œå½“è®­ç»ƒçš„æ•°æ®é›†è§„æ¨¡ä¸è¶³å¤Ÿå¤§æ—¶ï¼Œåè€Œä¼ ç»Ÿæ–¹æ³•çš„æ•ˆæœå¯èƒ½æ›´å¥½ä¸€äº›ï¼Œå› ä¸ºä¼ ç»Ÿæ–¹æ³•æ˜¯äººä»¬åŸºäºå›¾åƒçš„æŸäº›è§„å¾‹ï¼Œé€šè¿‡æ•°å­¦åˆ†ææ¨å¯¼å‡ºçš„èƒ½å¤Ÿè¾ƒå¥½åœ°æè¿°å›¾åƒä¸­äººè„¸ç‰¹å¾çš„ç®—æ³•ï¼Œå› è€Œå¯¹äºè¾ƒç®€å•çš„åœºæ™¯ã€è¾ƒå°çš„è®­ç»ƒé›†ï¼Œä¼ ç»Ÿç®—æ³•çš„ä¼˜åŠ¿æ˜æ˜¾ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©åœ¨ä¸Šä¸ªä¸–çºªå°±å‡ºç°äº†å„ç§ç¥ç»ç½‘ç»œï¼Œä½†æ˜¯ç›´åˆ°21ä¸–çºªä»¥åï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ·±åº¦å­¦ä¹ åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨æ‰é€æ¸è¿›å…¥ä¸»æµâ€”â€”å·¨å‹äººè„¸æ•°æ®é›†ä¸æ·±å±‚ç¥ç»ç½‘ç»œçš„æ­å»ºä¸è®¡ç®—æœºç®—åŠ›çš„è¿›æ­¥ã€‚
- å¦ä¸€ä¸ªå‘ç°æ˜¯ï¼Œåœ¨è®­ç»ƒè½®æ¬¡ç­‰å‚æ•°ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”äºä¼ ç»Ÿæ–¹æ³•ï¼Œå·ç§¯ç¥ç»ç½‘ç»œå¯¹ä¸åŒæ•°æ®é›†çš„é€‚åº”æ€§è¾ƒå¼ºï¼Œæˆ–è€…è¯´ç¨³å®šæ€§è¾ƒå¼ºâ€”â€”å®éªŒä¸­ï¼Œåœ¨ä¸åŒçš„äººè„¸æ•°æ®é›†ä¸‹ï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„å‡†ç¡®ç‡ç¨³å®šåœ¨0.8~0.9ä¹‹é—´ï¼Œè€Œä¼ ç»Ÿæ–¹æ³•çš„å‡†ç¡®ç‡çš„æ–¹å·®è¾ƒå¤§ã€‚è¿™å…¶å®ä¸ä¸¤è€…çš„åŸç†ç›´æ¥ç›¸å…³ï¼Œäººå·¥è®¾è®¡åœ¨æ— çº¦æŸç¯å¢ƒä¸­å¯¹ä¸åŒå˜åŒ–æƒ…å†µç¨³å¥çš„ç‰¹å¾æ˜¯å¾ˆå›°éš¾çš„ï¼Œè¿™ä½¿å¾—è¿‡å»çš„ç ”ç©¶è€…ä¾§é‡ç ”ç©¶é’ˆå¯¹æ¯ç§å˜åŒ–ç±»å‹çš„ä¸“ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚èƒ½åº”å¯¹ä¸åŒå¹´é¾„çš„æ–¹æ³•ã€èƒ½åº”å¯¹ä¸åŒå§¿åŠ¿çš„æ–¹æ³• ã€èƒ½åº”å¯¹ä¸åŒå…‰ç…§æ¡ä»¶çš„æ–¹æ³•ç­‰ï¼›ä½†æ˜¯æ·±åº¦å­¦ä¹ åˆ™ä¸ç„¶ï¼Œå®ƒä»¬å¯ç”¨éå¸¸å¤§å‹çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œä»è€Œå­¦åˆ°äººè„¸å›¾åƒä¸­ç¨³å¥çš„ç‰¹å¾ï¼Œèƒ½å¤Ÿåº”å¯¹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„äººè„¸å›¾åƒæ‰€å‘ˆç°å‡ºçš„çœŸå®ä¸–ç•Œå˜åŒ–æƒ…å†µã€‚

## é™„ï¼šå…³é”®ä»£ç 

### 1. å›¾åƒåŠ è½½ä¸å›¾åƒçŸ©é˜µåˆ—è¡¨å»ºç«‹ï¼ˆPCAã€LDAï¼‰

```python
def load_img(file_name):
    """
    è½½å…¥å›¾åƒï¼Œç»Ÿä¸€å°ºå¯¸ï¼Œç°åº¦åŒ–å¤„ç†ï¼Œç›´æ–¹å›¾å‡è¡¡åŒ–
    :param file_name: å›¾åƒæ–‡ä»¶å
    :return: å›¾åƒçŸ©é˜µ
    """
    t_img_mat = cv2.imread(file_name)  # è½½å…¥å›¾åƒ
    t_img_mat = cv2.resize(t_img_mat, IMG_SIZE)  # ç»Ÿä¸€å°ºå¯¸
    t_img_mat = cv2.cvtColor(t_img_mat, cv2.COLOR_RGB2GRAY)  # è½¬åŒ–ä¸ºç°åº¦å›¾
    img_mat = cv2.equalizeHist(t_img_mat)  # ç›´æ–¹å›¾å‡è¡¡
    return img_mat


def create_img_mat(dir_name, algorithm=0):
    """
    ç”Ÿæˆå›¾åƒæ ·æœ¬çŸ©é˜µï¼Œç»„ç»‡å½¢å¼ä¸ºè¡Œä¸ºå±æ€§ï¼Œåˆ—ä¸ºæ ·æœ¬
    :param dir_name: åŒ…å«è®­ç»ƒæ•°æ®é›†çš„å›¾åƒæ–‡ä»¶å¤¹è·¯å¾„
    :param algorithm: è¯†åˆ«ç®—æ³•ï¼Œ0-EigenFaceï¼Œ1-Fisherï¼Œ2-LBP
    :return: æ ·æœ¬çŸ©é˜µï¼Œæ ‡ç­¾çŸ©é˜µ
    """
    data_mat = np.zeros((IMG_SIZE[0] * IMG_SIZE[1], 1))
    label = []
    data_list = []
    for parent, dir_names, file_names in os.walk(dir_name):
        for t_dir_name in dir_names:
            for sub_parent, sub_dir_name, sub_file_names in os.walk(parent + '/' + t_dir_name):
                for t_index, t_file_name in enumerate(sub_file_names):
                    if not t_file_name.endswith('.jpg'):
                        continue
                    if t_file_name.endswith('.10.jpg'):
                        continue
                    t_img_mat = load_img(sub_parent + '/' + t_file_name)
                    img_mat = np.reshape(t_img_mat, (-1, 1))

                    if algorithm == 0:
                        data_mat = np.column_stack((data_mat, img_mat))
                    else:
                        data_mat = img_mat if t_index == 0 else np.column_stack((data_mat, img_mat))

                    label.append(sub_parent + '/' + t_file_name)
            data_list.append(data_mat[:, 1:] if algorithm == 0 else data_mat)
    return data_mat[:, 1:], label, data_list
```

### 2. å›¾åƒåˆ—è¡¨å»ºç«‹ï¼ˆLBPï¼‰

```python
class AlgorithmLbp(object):
    def __init__(self):
        self.table = {}
        self.ImgSize = IMG_SIZE
        self.BlockNum = DIM
        self.count = 0

    def load_img_list(self, dir_name):
        """
        åŠ è½½å›¾åƒçŸ©é˜µåˆ—è¡¨
        :param dir_name:æ–‡ä»¶å¤¹è·¯å¾„
        :return: åŒ…å«æœ€åŸå§‹çš„å›¾åƒçŸ©é˜µçš„åˆ—è¡¨å’Œæ ‡ç­¾çŸ©é˜µ
        """
        img_list = []
        label = []
        for parent, dir_names, file_names in os.walk(dir_name):
            for t_dir_name in dir_names:
                for sub_parent, sub_dir_name, sub_filenames in os.walk(parent + '/' + t_dir_name):
                    for file_name in sub_filenames:
                        img_list.append(load_img(sub_parent + '/' + file_name))  
                        label.append(sub_parent + '/' + file_name)
        return img_list, label
```

### 3. ç›´æ–¹å›¾å»ºç«‹ï¼ˆLBPï¼‰

```python
class AlgorithmLbp(object):
    def get_hop_counter(self, num):
        """
        è®¡ç®—äºŒè¿›åˆ¶åºåˆ—æ˜¯å¦åªå˜åŒ–ä¸¤æ¬¡
        :param num: æ•°å­—
        :return: 01å˜åŒ–æ¬¡æ•°
        """
        bin_num = bin(num)
        bin_str = str(bin_num)[2:]
        n = len(bin_str)
        if n < 8:
            bin_str = "0" * (8 - n) + bin_str
        n = len(bin_str)
        counter = 0
        for i in range(n):
            if i != n - 1:
                if bin_str[i + 1] != bin_str[i]:
                    counter += 1
            else:
                if bin_str[0] != bin_str[i]:
                    counter += 1
        return counter

    def get_table(self):
        """
        ç”Ÿæˆå‡åŒ€å¯¹åº”å­—å…¸
        :return: å‡åŒ€LBPç‰¹å¾å¯¹åº”å­—å…¸
        """
        counter = 1
        for i in range(256):
            if self.get_hop_counter(i) <= 2:
                self.table[i] = counter
                counter += 1
            else:
                self.table[i] = 0
        return self.table

    def get_lbp_feature(self, img_mat):
        """
        è®¡ç®—LBPç‰¹å¾
        :param img_mat:å›¾åƒçŸ©é˜µ
        :return: LBPç‰¹å¾å›¾
        """
        m = img_mat.shape[0]
        n = img_mat.shape[1]
        neighbor = [0] * 8
        feature_map = np.mat(np.zeros((m, n)))
        t_map = np.mat(np.zeros((m, n)))
        for y in range(1, m - 1):
            for x in range(1, n - 1):
                neighbor[0] = img_mat[y - 1, x - 1]
                neighbor[1] = img_mat[y - 1, x]
                neighbor[2] = img_mat[y - 1, x + 1]
                neighbor[3] = img_mat[y, x + 1]
                neighbor[4] = img_mat[y + 1, x + 1]
                neighbor[5] = img_mat[y + 1, x]
                neighbor[6] = img_mat[y + 1, x - 1]
                neighbor[7] = img_mat[y, x - 1]
                center = img_mat[y, x]
                temp = 0
                for k in range(8):
                    temp += (neighbor[k] >= center) * (1 << k)
                feature_map[y, x] = self.table[temp]
                t_map[y, x] = temp
        feature_map = feature_map.astype('uint8')  
        t_map = t_map.astype('uint8')
        self.count += 1
        return feature_map

    def get_hist(self, roi):
        """
        è®¡ç®—ç›´æ–¹å›¾
        :param roi:å›¾åƒåŒºåŸŸ
        :return: ç›´æ–¹å›¾çŸ©é˜µ
        """
        hist = cv2.calcHist([roi], [0], None, [59], [0, 256])  
        return hist
```

### 4. æµ‹è¯•å›¾åƒè·ç¦»è®¡ç®—ï¼ˆPCAã€LDAï¼‰

```python
def method_compare(mat_list, test_img_vec, algorithm=0):
    """
    æ¯”è¾ƒå‡½æ•°ï¼Œè¿™é‡Œåªæ˜¯ç”¨äº†æœ€ç®€å•çš„æ¬§æ°è·ç¦»æ¯”è¾ƒï¼Œè¿˜å¯ä»¥ä½¿ç”¨KNNç­‰æ–¹æ³•ï¼Œå¦‚éœ€ä¿®æ”¹ä¿®æ”¹æ­¤å¤„å³å¯
    :param mat_list: æ ·æœ¬å‘é‡é›†
    :param test_img_vec: æµ‹è¯•å›¾åƒå‘é‡
    :param algorithm: è¯†åˆ«ç®—æ³•ï¼Œ0-EigenFaceï¼Œ1-Fisherï¼Œ2-LBP
    :return: ä¸æµ‹è¯•å›¾ç‰‡æœ€ç›¸è¿‘çš„å›¾åƒæ–‡ä»¶åçš„index
    """
    dis_list = []
    if algorithm == 0:
        for sample_vec in mat_list.T:
            dis_list.append(np.linalg.norm(test_img_vec - sample_vec))

    elif algorithm == 1:
        # print('mat_list.len=', len(mat_list))
        for trans_mat in mat_list:
            for sample_vec in trans_mat.T:
                dis_list.append(np.linalg.norm(test_img_vec - sample_vec))
    index = np.argsort(dis_list)[0]
    return index
```

### 5. æµ‹è¯•å›¾åƒè·ç¦»è®¡ç®—ï¼ˆLBPï¼‰

```python
class AlgorithmLbp(object):
    def compare(self, sampleImg, test_img):
        """
        æ¯”è¾ƒå‡½æ•°ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯æ¬§æ°è·ç¦»æ’åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨KNNï¼Œåœ¨æ­¤å¤„æ›´æ”¹
        :param sampleImg: æ ·æœ¬å›¾åƒçŸ©é˜µ
        :param test_img: æµ‹è¯•å›¾åƒçŸ©é˜µ
        :return: k2å€¼
        """
        testFeatureMap = self.get_lbp_feature(test_img)
        sampleFeatureMap = self.get_lbp_feature(sampleImg)
        # è®¡ç®—æ­¥é•¿ï¼Œåˆ†å‰²æ•´ä¸ªå›¾åƒä¸ºå°å—
        ystep = int(self.ImgSize[0] / self.BlockNum)
        xstep = int(self.ImgSize[1] / self.BlockNum)

        k2 = 0
        for y in range(0, self.ImgSize[0], ystep):
            for x in range(0, self.ImgSize[1], xstep):
                testroi = testFeatureMap[y:y + ystep, x:x + xstep]
                sampleroi = sampleFeatureMap[y:y + ystep, x:x + xstep]
                testHist = self.get_hist(testroi)
                sampleHist = self.get_hist(sampleroi)
                k2 += np.sum((sampleHist - testHist) ** 2) / np.sum((sampleHist + testHist))
        return k2
```

